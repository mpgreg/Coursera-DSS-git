---
title: "Analysis of Severe Weather Events for Human and Economic Impact"
output:
  html_document:
    keep_md: true
---
```{r setoptions,echo = FALSE}
library(knitr)
opts_chunk$set(echo = TRUE, restult = "hide")
```

##Synopsis: 
Storms and other severe weather events can cause both public health and economic problems for communities and municipalities. Many severe events can result in fatalities, injuries, and property damage, and preventing such outcomes to the extent possible is a key concern.  This project involves exploring the U.S. National Oceanic and Atmospheric Administration's (NOAA) storm database. This database tracks characteristics of major storms and weather events in the United States, including when and where they occur, as well as estimates of any fatalities, injuries, and property damage.

##Data Processing: 
The NOAA Storm Event Database (herein, database) records 37 variables on storm events from 1950 to present day.  This project will use [a subset of the data](https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2) with nearly 1 million storm events from April 1950 to November 2011.  In addition to the dataset [Documentation](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2Fpd01016005curr.pdf) and [FAQs](https://d396qusza40orc.cloudfront.net/repdata%2Fpeer2_doc%2FNCDC%20Storm%20Events-FAQ%20Page.pdf) are available.

###Start by downloading and reading in the database file.

```{r}
fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
tempFile <- tempfile()
if(capabilities("libcurl")) {
        download.file(fileURL, tempFile, method = "libcurl")        
} else {
        download.file(fileURL, tempFile)
}
```

- To cut down on processing and cleaning time we will import only columns relating to the type of event, fatalities, injuries, and property damage.
```{r cache=TRUE}
#Grab the headers list.
headers <- read.csv(tempFile, nrows = 1)
#Ignore all columns except the ones we specify.
headers[,] <- c(rep("NULL", ncol(headers)))
headers[c("FATALITIES", "INJURIES", "PROPDMG", "CROPDMG")] <- "numeric"
headers[c("BGN_DATE", "PROPDMGEXP", "CROPDMGEXP")] <- "factor"
headers[c("EVTYPE")] <- "character"
#Read in the specified columns
StormDF <- read.table(tempFile, header = TRUE, sep = ",", quote = "\"", fill = TRUE, comment.char = "", colClasses = headers)
unlink(tempFile)

```

###Clean and preprocess the data to look for anomalies and obvious errors.
- Assign better column names.
```{r}
names(StormDF)[names(StormDF) == "EVTYPE"] <- "Event.Type"
names(StormDF)[names(StormDF) == "BGN_DATE"] <- "Begin.Date"
names(StormDF)[names(StormDF) == "FATALITIES"] <- "Fatalities"
names(StormDF)[names(StormDF) == "INJURIES"] <- "Injuries"
names(StormDF)[names(StormDF) == "PROPDMG"] <- "Property.Damage"
names(StormDF)[names(StormDF) == "PROPDMGEXP"] <- "Property.Damage.Exponent"
names(StormDF)[names(StormDF) == "CROPDMG"] <- "Crop.Damage"
names(StormDF)[names(StormDF) == "CROPDMGEXP"] <- "Crop.Damage.Exponent"
```

-Drop all rows with no Health or Economic loss
```{r}
StormDF <- StormDF[!rowSums(StormDF[c("Fatalities","Injuries","Property.Damage","Crop.Damage")])==0,]
```

- Check if there are missing values.
```{r}
anyNA(StormDF)
```

- Are the Property Damage and Crop Damage exponent fields accurate?
```{r}
unique(StormDF$CROPDMGEXP)
unique(StormDF$PROPDMGEXP)
```
-- Does the number of incorrect values in "exponent" fields represent a statistically relevant set?
```{r}
allowedExp <- c("k", "K", "M", "m", "B", "b", "0", "0.0", "0.00", NA, "")
percErrors <- round(nrow(subset(StormDF, !PROPDMGEXP %in% allowedExp | !CROPDMGEXP %in% allowedExp)) / nrow(StormDF), 5)*100
```

Events with erroneous exponent fields represent `r percErrors` percent of the data.

- Property and crop damage are reported with dollar amount and exponential units in separate columns.  Calculate the damage cost by multiplying the exponents and combining.
```{r cache=TRUE}
StormDF["PROPDMG.FULL"] <- StormDF["PROPDMG"]
StormDF[StormDF$PROPDMGEXP %in% c("k","K"),"PROPDMG.FULL"] <- 
        StormDF[StormDF$PROPDMGEXP %in% c("k","K"),"PROPDMG"]*1000
StormDF[StormDF$PROPDMGEXP %in% c("m","M"),"PROPDMG.FULL"] <- 
        StormDF[StormDF$PROPDMGEXP %in% c("m","M"),"PROPDMG"]*1000000
StormDF[StormDF$PROPDMGEXP %in% c("b","B"),"PROPDMG.FULL"] <- 
        StormDF[StormDF$PROPDMGEXP %in% c("b","B"),"PROPDMG"]*1000000000
#Do the same for crop damage
StormDF["CROPDMG.FULL"] <- StormDF["CROPDMG"]
StormDF[StormDF$CROPDMGEXP %in% c("k","K"),"CROPDMG.FULL"] <- 
        StormDF[StormDF$CROPDMGEXP %in% c("k","K"),"CROPDMG"]*1000
StormDF[StormDF$CROPDMGEXP %in% c("m","M"),"CROPDMG.FULL"] <- 
        StormDF[StormDF$CROPDMGEXP %in% c("m","M"),"CROPDMG"]*1000000
StormDF[StormDF$CROPDMGEXP %in% c("b","B"),"CROPDMG.FULL"] <- 
        StormDF[StormDF$CROPDMGEXP %in% c("b","B"),"CROPDMG"]*1000000000
```

-- Add columns to summarize economic and personal health impact.
```{r cache=TRUE}
StormDF["Economic.Impact"] <- StormDF$PROPDMG.FULL + StormDF$CROPDMG.FULL
StormDF["Health.Impact"] <- StormDF$FATALITIES + StormDF$INJURIES
```





##Results: in which your results are presented.

You may have other sections in your analysis, but Data Processing and Results are required.

The analysis document must have at least one figure containing a plot.

Your analyis must have no more than three figures. Figures may have multiple plots in them (i.e. panel plots), but there cannot be more than three figures total.

You must show all your code for the work in your analysis document. This may make the document a bit verbose, but that is okay. In general, you should ensure that echo = TRUE for every code chunk (this is the default setting in knitr).